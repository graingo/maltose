## 工程实践与代码生成

Maltose 提倡关注点分离 (SoC) 和约定优于配置 (CoC) 的原则。为了在提升开发效率的同时保持代码结构清晰、易于维护，我们设计了一套受 GoFrame 启发的工程结构，并提供了强大的代码生成工具 `maltose gen dao`。

### 推荐目录结构

```
project-name/
├── api/                # API 接口定义 (对外暴露的 Request/Response)
├── internal/           # 核心业务逻辑 (不对外暴露)
│   ├── controller/     # 接口层: 负责请求校验、调用服务、返回响应
│   ├── model/          # 业务模型 (Service 层的输入/输出，手动维护)
│   │   ├── entity/     # 数据模型 (由工具生成，与数据库表一一对应)
│   │   └── do/         # 领域对象 (手动维护，用于复杂查询或自定义数据结构)
│   ├── service/        # 业务层: 负责业务逻辑的实现与封装
│   ├── dao/            # 数据访问层 (由工具首次生成，可手动扩展)
│   │   └── internal/   # 内部 DAO (由工具生成，包含基础 CRUD)
│   └── ...             # 其他业务相关目录
├── .env                # 配置文件 (用于数据库连接等)
└── main.go             # 项目入口
```

### 分层设计哲学

这套结构的核心思想是 **将自动生成的代码与开发者手写的代码安全地分离开**，使得您可以随时重新生成代码以适应数据库变更，而不用担心覆盖自己的业务逻辑。

#### Model 层详解

- **`internal/model/entity/`**

  - **来源**: 由 `maltose gen dao` 工具根据数据库表结构自动生成。
  - **用途**: 作为 GORM 的模型，与数据库表严格一一对应。
  - **规则**: **不应手动修改**。文件头部有 `DO NOT EDIT` 标识。

- **`internal/model/do/` (Domain Object)**

  - **来源**: 开发者手动创建。
  - **用途**: 定义非标准的数据结构。最常见的场景是存放 **多表联合查询** 的结果。
  - **规则**: 完全由开发者维护。

- **`internal/model/`**
  - **来源**: 开发者手动创建。
  - **用途**: 定义 **业务模型**，作为 `Service` 层公共方法的输入（Input）和输出（Output）参数。它构成了 `Controller` 和 `Service` 之间的"胶水层"，实现业务逻辑与特定接口的解耦。
  - **规则**: 完全由开发者维护。`Service` 层应避免直接使用 `api` 或 `entity` 中的结构体。

#### DAO 层详解

- **`internal/dao/internal/`**

  - **来源**: 由 `maltose gen dao` 工具自动生成。
  - **用途**: 包含了每张表最基础的 CRUD 方法。
  - **规则**: **不应手动修改**，每次代码生成时都会被覆盖。

- **`internal/dao/`**
  - **来源**: 由工具在 **第一次** 生成时创建。
  - **用途**: 封装 `internal` 中的 DAO，并作为业务的统一数据访问入口。**所有自定义的数据库操作**（如复杂的链式查询、手写 SQL 等）都应在此层中添加为新方法。
  - **规则**: **可以随意修改和扩展**。由于工具不会覆盖此目录下的已有文件，您的自定义逻辑是安全的。

通过这种设计，开发者可以将精力聚焦在 `service` 层的业务逻辑、`dao` 层的复杂查询以及 `controller` 层的接口处理上，而将繁琐的基础模型和 DAO 代码交给 `maltose` 工具自动完成。
